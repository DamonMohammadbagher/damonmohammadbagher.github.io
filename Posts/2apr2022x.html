<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Dll Hollowing Attack vs ESET Endpoint AV / Kaspersky Endpoint Security</title>
    <link rel="Stylesheet" type="text/css" media="all" href="2apr2022x_files/styles.css">
    <style>

    </style>

</head>

<body style="tab-interval:35.45pt" vlink="blue" link="darkorange" lang="EN-US" bgcolor="white"
    background="2apr2022x_files/x3.jpeg">

    <div class="Section1">

        <div>

            <div id="header">

                <p class="MsoNormal" style="margin:2.25pt;line-height:30.0pt;mso-outline-level:
2;background:#F3F2ED"><b><span style="font-family:Arial;
mso-font-kerning:18.0pt">Dll Hollowing Attack vs ESET Endpoint AV / Kaspersky Endpoint Security</span></b></p>

            </div>

            <p><b><span style="font-family:Arial">
                        <o:p>&nbsp;</o:p>
                    </span></b></p>

            <p><b><span style="font-family:Arial">Dll Hollowing Attack vs ESET Endpoint AV / Kaspersky Endpoint
                        Security<span style="mso-spacerun:yes">&nbsp; </span>
                        <o:p></o:p>
                    </span></b></p>

            <p><span style="font-family: Arial"></span></p>
            <p>in this article you can see how some type of Attack still is working Against some Anti-virus , in this case i want to talk about (Dll Hollowing) 
                attack which Was Detected by Kaspersky Endpoint Security but Shell code and Session still working also this Technique Not Detected by ESET Endpoint AV.
            </p>
            
            <p>as you can see in the "Picture1" Reverse shell code was injected into Mspaint:2628 via DLL Hollowing attack and this dll was Amsi.dll</p>
                          
            <p><img src="2apr2022x_files/1.png" width="1283" height="703" border="0"></p>
            <p>Picture 1: Kaspersky Endpoint Security v11</p>
            <p>&nbsp;</p>
            <p>in the "Picture 1" you can see MSPAINT:2628 was detected by Kaspersky also Object Deleted (which means Mspaint.exe Terminated by AV also Injector Deleted by AV) 
                but as you can see we still have Session , that means child Process (cmd.exe) for Mspaint.exe still is active </p>
            <p>&nbsp;</p>
            <p><img src="2apr2022x_files/2.png" width="1293" height="707" border="0"></p>
            <p>Picture 2: </p>
            <p>&nbsp;</p>
            <p>so you can see reverse shell still is working and time was for after detection by Kaspersky Endpoint Security, Detection time was 9:41 but time command out was for 
                9:57 that means reverse shell code/payload or (process cmd.exe:2072) was not detected as reverse shell code by Kaspersky Endpoint Security.
                so you can see Injector Was detected by AV very well also Mspaint Terminated by AV but Reverse shell Connection/session still is working. ¯\_(ツ)_/¯
            </p>
             
            <p>as you can see in the "Picture 3" , i tested this attack again in this time i used ETWPM2Monitor2.1 for Monitoring ETW Events for dll Injection Attack</p>
            <p><img src="2apr2022x_files/3.png" width="1286" height="674" border="0"></p>
            <p>Picture 3: </p>
            <p>in the "Picture4" you can see more details for dll Injection attack via ETW Events</p>
            <p><img src="2apr2022x_files/4.png" width="1286" height="676" border="0"></p>
            <p>Picture 4: injection events</p>
            <p>&nbsp;</p>
            <p>in the "Picture 5", you can see i tested ESET Endpoint Anti-virus via Dll Hollowing Attack and you can see this Technique not detected by ESET.</p>

            <p>you can see Dll hollowing Injection not Detected by
               ESET and Session still is working very well. ¯\_(ツ)_/¯ </p>
            <p><img src="2apr2022x_files/7.png" width="1291" height="709" border="0"></p>
            <p>Picture 5: ESET Endpoint Anti-virus v9</p>
            <p>&nbsp;</p>
            <p>in the "Picture 6" you can see "cmd.exe:7988" was detected by ETW events you can see this process in the Processhacker in the "Picture 5" </p>
            <p><img src="2apr2022x_files/6.png" width="1283" height="703" border="0"></p>
            <p>Picture 6:  </p>
            <p>&nbsp;</p>
        
            
            <p><b>Note:</b> C# codes for ETWPM2Monitor2.1 is here: <a target="_blank"
                    href="https://github.com/damonmohammadbagher/ETWProcessMon2">https://github.com/damonmohammadbagher/ETWProcessMon2</a>
            </p>

            <p><b>at a glance:</b> as defender (Blue teams) you can see sometimes Anti-virus Detection
                is not very well and some type of attacks still working very well Against Detection systems like AV/EDRs, it is not about these two AVs , it is about
                All Anti-viruses/EDRs and you should check them one by one ¯\_(ツ)_/¯ </p>

            <div id="footer">

                <p class="MsoNormal" style="margin:3.0pt;background:#6F6F6F"><span
                        style="font-family:Arial;color:white">Last Update: 02 Apr 2022 <o:p></o:p></span></p>
            </div>
        </div>
    </div>
     <p><a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://damonmohammadbagher.github.io/Posts/2apr2022x.html"/></a></p>
</body>

</html>
