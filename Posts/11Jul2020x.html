<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<title>Windows Defender Bypassed very simple... (Payload Detection In-memory)</title>
<link rel=Stylesheet type="text/css" media=all href="11Jul2020x_files/styles7.css">
<style>

</style>

</head>

<body bgcolor=white background="11Jun2020x_files/x3.jpeg" lang=EN-US
link=darkorange vlink=blue style='tab-interval:35.45pt'>

<div  class=Section1>

<div >

<div id=header>

<p class=MsoNormal style='margin:2.25pt;line-height:30.0pt;mso-outline-level:
2;background:#F3F2ED'><b><span style='font-family:Arial;
mso-font-kerning:18.0pt'>Windows Defender Bypassed very simple... (Payload Detection In-Memory)<o:p></o:p></span></b></p>

</div>

<p><b><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></b></p>

<p><b><span style='font-family:Arial'>Windows Defender Bypassed very simple...<span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></b></p>

<p><span style='font-family:Arial'>In this post i want to talk about Payload Detection in memory by Anti-viruses 
	so let me show you my last test about C# Delegete technique for bypassing AV in this case "Windows Defender" 
	<p><span style='font-family:Arial'><o:p>Windows Defender Bypassed very simple by C# Delegate technique, 
		as you can see we have "same" payload "in-Memory" for both codes but only one of them Detected by Windows Defender... ;).</o:p></span></p>
<p>&nbsp;</p>
	<o:p></o:p></span></p>
	<span style='font-family:Arial'></span>
	<p><b><span style='font-family:Arial'>Meterpreter Payload Thread Created by "NtCreateThreadEx" Detected by Windows Defender AV, (Local Thread) [step2]</span></b></p>
	<p><b><span style='font-family:Arial'>Meterpreter Payload injected into Notepad Not Detected by Windows Defender AV, (Remote Thread) [step 2-1]</span></b></p>
<p><span style='font-family:Arial'>
	<span class=SpellE><b style='mso-bidi-font-weight:normal'> </b></span> <span
class=SpellE> </span>  <o:p></o:p></span></p>

<p><font face="Arial"><span dir="ltr"><b>Detection &quot;in memory&quot;:</b> some AVs have same 
Problems like this (more often).</span></font><span style='font-family:Arial'><o:p>&nbsp;</o:p></span></p>
<p>&nbsp;</p>

<p><font face="Arial"><span dir="ltr"><strong>Step 1</strong>: in this step Windows Defender is 
off, as you can see both codes have same payload &amp; worked very well...</span></font></p>
<p><font face="Arial"><i>(for better resolution: please click on picture) </i>&nbsp;</font></p>

<p><a target="_blank" href="11Jul2020x_files/3.png">
<img border="0" src="11Jul2020x_files/3.png" width="100%" height="100%"></a></p>
<p>Picture 1: Windows Defender is off, both codes worked very well.</p>
<p>&nbsp;</p>
<p><span dir="ltr">1)<b> Meterpreter Payload injected into Notepad (Remote 
Thread)</b></span></p>
<ul>
	<li><i>in this test Meterpreter payload injected to Notepad Process by &quot;NativePayload_TImd&quot;</i></li>
</ul>
<p><span dir="ltr">2) <b>Meterpreter Payload Thread Created by &quot;NtCreateThreadEx&quot; 
(Local Thread)</b></span></p>
<ul>
	<li><i><span dir="ltr">in this test Meterpreter payload created &nbsp;by &quot;NtCreateThreadEx&quot; 
	in local process<br>
&nbsp;</span></i></li>
</ul>
<p><span dir="ltr">as you can see both code worked very well when Windows 
Defender was &quot;OFF&quot;.</span></p>
<p><br>
<span dir="ltr"><strong>Step 2</strong>: in this &quot;step 2&quot; &amp; &quot;step 2-1&quot; 
Windows Defender is &quot;ON&quot; and i want to test both codes one by one with AV...</span></p>
<p><span dir="ltr">as you can see in the &quot;picture 2&quot;, my code detected by 
Windows Defender AV it means C# and/or Meterpreter Payload in Memory Detected by 
AV.</span></p>
<p>&nbsp;</p>
<p><font face="Arial"><i>(for better resolution: please click on picture) </i>&nbsp;</font></p>

<p><a target="_blank" href="11Jul2020x_files/2.png">
<img border="0" src="11Jul2020x_files/2.png" width="100%" height="100%"></a></p>
<p>Picture 2: Windows Defender is on, Meterpreter Payload &amp; Code Detected by 
Windows Defender AV.</p>
<p>&nbsp;</p>
<p>in the picture 2 you can see Meterpreter payload (local thread) which made by 
&quot;<b><span dir="ltr">NtCreateThreadEx</span></b>&quot; in the process &quot;NativePayload_TIdsc.exe&quot; 
Detected by AV &quot;very good&quot;.<br>
&nbsp;</p>
<p><strong>Step 2-1</strong>: in this step my Meterpreter payload injected into 
Notepad process (create remote thread) and in this code i used Delegate 
techniques and you can see</p>
<p>in then next &quot;Picture 3&quot; , Windows Defender &quot;Bypassed&quot;.</p>
<p><font face="Arial"><i>(for better resolution: please click on picture) </i>&nbsp;</font></p>
<p><a target="_blank" href="11Jul2020x_files/1.png">
<img border="0" src="11Jul2020x_files/1.png" width="100%" height="100%"></a></p>
<p>Picture 3: Windows Defender is on, Meterpreter Payload &amp; code Not Detected by 
Windows Defender AV.</p>
<p>&nbsp;</p>
<p>so we have same Meterpreter payload &quot;in-memory&quot; with different 
codes/techniques but Windows defender detected only one of them ...</p>
<p>as you can see Payload Detection &quot;in-Memory&quot; does not work very well and some 
Anti-viruses have same problems like this too.</p>
<p><s>​</s>in the next &quot;chapter 14&quot; for eBook &quot;<b>Bypassing AVs by C# 
Programming</b>&quot; which i still working on, i wan to talk about Delegate 
Technique with C# and some Anti-Viruses.</p>
<p>&nbsp;</p>
<p>I tested my code with AV &quot;last updates&quot; and you can see C# Delegate code 
worked &amp; Windows Defender Bypassed with Last update (10 July 2020).</p>
<p>&nbsp;</p>
<p>
<img border="0" src="11Jul2020x_files/updatedx1.png" width="1366" height="693"></p>
<p>Picture 3-1: Windows Defender is on, Meterpreter Payload &amp; code Not Detected 
by Windows Defender AV.</p>
<p>&nbsp;</p>
<p>and that code with &quot;<b><span dir="ltr">NtCreateThreadEx</span></b>&quot; still 
detected by Windows defender .</p>
<p>&nbsp;</p>
<p>
<img border="0" src="11Jul2020x_files/updatedx2.png" width="1366" height="679"></p>
<p>Picture 4: Windows Defender is on, Meterpreter Payload &amp; code Detected by 
Windows Defender AV.</p>
<p>&nbsp;</p>
<p>
<img border="0" src="11Jul2020x_files/updatedx3.png" width="1364" height="683"></p>
<p>Picture 4-1: Windows Defender is on, Meterpreter Payload &amp; code Detected by 
Windows Defender AV. (good job)</p>
<p>&nbsp;</p>
<p><span style="font-family: Arial">I will Publish &quot;chapter 14&quot; soon, but 
Anti-viruses still have a lot Problems, </span></p>
<p><span style="font-family: Arial">which one of them is &quot;Payload Detection in 
memory&quot;. </span></p>
<p>&nbsp;</p>

<div id=footer>

<p class=MsoNormal style='margin:3.0pt;background:#6F6F6F'><span
style='font-family:Arial;color:white'>Last Update: 11 Jul 2020 <o:p></o:p></span></p>

</div>

</div>

</div>
 <p><a href="https://hits.seeyoufarm.com"><img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https://damonmohammadbagher.github.io/Posts/11Jul2020x.html"/></a></p>

</body>

</html>
